<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Petshop - Gerenciamento</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 16px; }
    h2 { margin-top: 24px }
    form { margin-bottom: 12px }
    label { display:block; margin:6px 0 2px }
    input[type=text], input[type=email], input[type=number] { padding:6px; width:300px }
    table { border-collapse: collapse; width: 100%; margin-top:8px }
    table, th, td { border: 1px solid #ccc }
    th, td { padding: 8px; text-align: left }
    .row { display:flex; gap:12px; align-items:center }
    .col { flex: 1 }
    button { padding:8px 12px }
    .small { width:120px }
    .notice { color: #666; font-size: 0.9em }
  </style>
</head>
<body>
  <h1>Petshop - Gerenciamento</h1>

  <section id="clientes-section">
    <h2>Clientes</h2>
    <form id="cliente-form">
      <label for="c_nome">Nome</label>
      <input id="c_nome" name="nome" type="text" required />
      <label for="c_email">E-mail</label>
      <input id="c_email" name="email" type="email" required />
      <label for="c_telefone">Telefone</label>
      <input id="c_telefone" name="telefone" type="text" />
      <div style="margin-top:8px">
        <button type="submit">Criar Cliente</button>
      </div>
    </form>

    <div class="notice">Lista de clientes cadastrados</div>
    <table id="clientes-table">
      <thead><tr><th>ID</th><th>Nome</th><th>E-mail</th><th>Telefone</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="pets-section">
    <h2>Pets</h2>
    <form id="pet-form">
      <label for="p_nome">Nome</label>
      <input id="p_nome" name="nome" type="text" required />
      <label for="p_especie">Espécie</label>
      <input id="p_especie" name="especie" type="text" />
      <label for="p_raca">Raça</label>
      <input id="p_raca" name="raca" type="text" />
      <label for="p_idade">Idade</label>
      <input id="p_idade" name="idade" type="number" min="0" class="small" />
      <label for="p_cliente">Cliente ID (dono)</label>
      <input id="p_cliente" name="cliente_id" type="number" required class="small" />
      <div style="margin-top:8px">
        <button type="submit">Criar Pet</button>
      </div>
    </form>

    <div class="notice">Lista de pets cadastrados</div>
    <table id="pets-table">
      <thead><tr><th>ID</th><th>Nome</th><th>Espécie</th><th>Raça</th><th>Idade</th><th>Cliente ID</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    const API = 'http://localhost:8000'

    async function fetchClientes() {
      const res = await fetch(API + '/clientes')
      const data = await res.json()
      const tbody = document.querySelector('#clientes-table tbody')
      tbody.innerHTML = ''
      data.forEach(c => {
        const tr = document.createElement('tr')
        tr.innerHTML = `<td>${c.id}</td><td>${c.nome}</td><td>${c.email}</td><td>${c.telefone||''}</td>`
        tbody.appendChild(tr)
      })
    }

    async function fetchPets() {
      const res = await fetch(API + '/pets')
      const data = await res.json()
      const tbody = document.querySelector('#pets-table tbody')
      tbody.innerHTML = ''
      data.forEach(p => {
        const tr = document.createElement('tr')
        tr.innerHTML = `<td>${p.id}</td><td>${p.nome}</td><td>${p.especie||''}</td><td>${p.raca||''}</td><td>${p.idade||''}</td><td>${p.cliente_id}</td>`
        tbody.appendChild(tr)
      })
    }

    document.getElementById('cliente-form').addEventListener('submit', async (e) => {
      e.preventDefault()
      const nome = document.getElementById('c_nome').value
      const email = document.getElementById('c_email').value
      const telefone = document.getElementById('c_telefone').value
      try {
        const res = await fetch(API + '/clientes', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ nome, email, telefone })
        })
        if (!res.ok) {
          const err = await res.json(); alert('Erro: ' + (err.detail || res.statusText)); return
        }
        e.target.reset()
        await fetchClientes()
      } catch (err) { alert('Erro de rede: ' + err.message) }
    })

    document.getElementById('pet-form').addEventListener('submit', async (e) => {
      e.preventDefault()
      const nome = document.getElementById('p_nome').value
      const especie = document.getElementById('p_especie').value
      const raca = document.getElementById('p_raca').value
      const idade = document.getElementById('p_idade').value || null
      const cliente_id = parseInt(document.getElementById('p_cliente').value, 10)
      try {
        const res = await fetch(API + '/pets', {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ nome, especie, raca, idade: idade?Number(idade):null, cliente_id })
        })
        if (!res.ok) {
          const err = await res.json(); alert('Erro: ' + (err.detail || res.statusText)); return
        }
        e.target.reset()
        await fetchPets()
      } catch (err) { alert('Erro de rede: ' + err.message) }
    })

    // initial load
    fetchClientes()
    fetchPets()
  </script>
</body>
</html>
